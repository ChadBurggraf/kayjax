Kayjax={requests:[],maxCount:10,onStop:function(){},onSend:function(){},onStart:function(){},onReceive:function(){},appendQuery:function(a,b){},fireEndEvents:function(){if(typeof Kayjax.onReceive==="function"){try{Kayjax.onReceive()}catch(a){}}if(Kayjax.requests.length===0&&typeof Kayjax.onStop==="function"){try{Kayjax.onStop()}catch(a){}}},fireStartEvents:function(){if(Kayjax.requests.length===0&&typeof Kayjax.onStart==="function"){try{Kayjax.onStart()}catch(a){}}if(typeof Kayjax.onSend==="function"){try{Kayjax.onSend()}catch(a){}}},getReasonFromResponseCode:function(a){var b="OK";if(a>=300){if(a<400){b="The server attempted to redirect the request."}else{if(a<500){b="Invalid request or access denied."}else{if(a<600){b="Internal server error."}else{b="An unspecified HTTP error occurred."}}}}return b},prepareParameters:function(b){var c,a;if(typeof b!=="undefined"){for(c in b){if(b.hasOwnProperty(c)){a=Object.prototype.toString.call(b[c]);if(a==="[object Date]"){b[c]=b[c].toJson()}else{if(a==="[object Object]"){b[c]=Kayjax.prepareParameters(b[c])}}}}}return b},resolveUrl:function(a){var b=/^~\//;if(b.test(a)){if(typeof Kayjax.appPath==="string"){if(!/\/$/.test(Kayjax.appPath)){Kayjax.appPath=Kayjax.appPath+"/"}}else{Kayjax.appPath="/"}a=a.replace(b,Kayjax.appPath)}return a},request:function(b,a){},response:function(d,g){var h,a,l,j,c,b,f,m;l=[];b=d.getResponseHeader("X-Response-Id");f={success:true,reason:"",value:null};m=d.responseText||"";try{h=g(m.replaceJSONDates());f.success=h.success;f.reason=h.reason;f.value=h.value}catch(k){f.success=false;f.reason="An invalid response was received from the server."}if(!f.success&&!f.reason){f.reason=Kayjax.getReasonFromResponseCode(d.status)}for(j=0,c=Kayjax.requests.length;j<c;j++){if(Kayjax.requests[j].id.toString()===b){a=Kayjax.requests[j]}else{l.push(Kayjax.requests[j])}}Kayjax.requests=l;if(a){if(typeof a.callback==="function"){a.callback(f)}}else{if(!f.success){alert(f.reason)}}Kayjax.fireEndEvents();return f},update:function(c,b,a){},updateResponse:function(h,c){var g,e,a,d,b,f;g=h.getResponseHeader("X-Response-Id");a=[];d={success:true,reason:"",value:""};if(h.status!==0&&!(h.status>=200&&h.status<300)){d.success=false;d.reason=Kayjax.getReasonFromResponseCode(h.status)}else{d.value=h.responseText||""}for(b=0,f=Kayjax.requests.length;b<f;b++){if(Kayjax.requests[b].id.toString()===g){e=Kayjax.requests[b]}else{a.push(Kayjax.requests[b])}}Kayjax.requests=a;if(typeof c==="string"){c=document.getElementById(c)}c.innerHTML=d.value;if(e){if(typeof e.callback==="function"){e.callback(d)}}else{if(!d.success){alert(d.reason)}}Kayjax.fireEndEvents();return d}};Date.prototype.toJson=function(){return"/Date("+this.getTime()+")/"};Date.prototype.toShortDateString=function(e,d){e=e||"ymd";d=d||"-";var b=this.getFullYear();var c=this.getMonth()+1;var a=this.getDate();if(c<10){c="0"+c}if(a<10){a="0"+a}switch(e){case ("mdy"):return c+d+a+d+b;case ("dmy"):return a+d+c+d+b;default:return b+d+c+d+a}};Date.prototype.toShortTimeString=function(){var a=this.getHours();var c=this.getMinutes();var b=a<12?"AM":"PM";if(a==0){a=12}else{if(a>12){a-=12}}if(c<10){c="0"+c}return a+":"+c+" "+b};Date.fromJson=function(json){return typeof json==="string"&&json.isJsonDate()?eval(json.replace(String.DATE_EXP,"new Date($1)")):NaN};String.prototype.camel=function(){var a=/^([A-Z])/.exec(this);if(a){return a[1].toLowerCase()+this.substr(1)}else{return this}};String.prototype.getUrlScheme=function(){var a="";var b=/^([^:]+)/.exec(this);if(b&&b.length>1){a=b[1]}return a};String.prototype.isJsonDate=function(){return this.match(String.DATE_EXP)};String.prototype.replaceJSONDates=function(){return this.replace(/"\\\/Date\(([\d\-]+)\)\\\/"/g,"new Date($1)")};String.prototype.trim=function(){return this.replace(/^\s+/g,"").replace(/\s+$/g,"")};String.DATE_EXP=(/^\/Date\(([\d-]+)\)\/$/);$.extend(Kayjax,{appendQuery:function(a,c){var b=(a.indexOf("?")>=0)?$.parseQuery(a.substr(a.indexOf("?")+1)):{};$.extend(b,(typeof c==="string"?$.parseQuery(c):{}));c=$.param(b);return a.split("?")[0]+(c?"?"+c:"")},request:function(b,a){if(Kayjax.requests.length>=Kayjax.maxCount){setTimeout(function(){Kayjax.request(b,a)},100)}else{Kayjax.fireStartEvents();a=a||{};var f,c,e,d;f={id:Kayjax.requests.length,callback:a.callback||null};Kayjax.requests.push(f);c=a.parameters?$.toJSON(Kayjax.prepareParameters(a.parameters)):"";e={contentType:"application/json",async:(typeof f.callback==="function")?true:false,data:c,processData:false,url:Kayjax.appendQuery(Kayjax.resolveUrl(b),a.query),type:"POST",beforeSend:function(g){g.setRequestHeader("X-Request-Id",f.id)}};if(e.async){e.complete=function(g){Kayjax.response(g,$.evalJSON)}}d=$.ajax(e);if(!e.async){return d}}},update:function(c,b,a){if(Kayjax.requests.length>=Kayjax.maxCount){setTimeout(function(){Kayjax.update(c,b,a)},100)}else{Kayjax.fireStartEvents();a=a||{};var e,d;e={id:Kayjax.requests.length,callback:a.callback||null};Kayjax.requests.push(e);d={async:(typeof e.callback==="function")?true:false,data:a.postBody,url:Kayjax.appendQuery(Kayjax.resolveUrl(b),a.query),type:"POST",beforeSend:function(f){f.setRequestHeader("X-Request-Id",e.id)},complete:function(f){Kayjax.updateResponse(f,c)}};$.ajax(d)}}});